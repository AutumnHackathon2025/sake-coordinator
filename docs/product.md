# 仕様

# テーマ

味で楽しむ日本酒おすすめサービス

# 機能

順番は実装順。最低2、できれば4 まで行きたい。5はなくても十分成立する。

## 1\. 日本酒の推薦機能

* **価値:** ユーザーの好みに基づき、メニューから最適な日本酒を推薦し、注文の失敗を減らす。  
* **入力:**  
  * 推薦対象の日本酒リスト  
    * 「メニュー」データ形式  
    * 当初は手入力  
* **出力:**  
  * おすすめの日本酒リスト（上位10件、「推薦結果」データ形式  
* **正常系処理フロー:**  
  1. ユーザーが推薦機能の開始を指示する。  
  2. システムはユーザーの飲酒歴データ（モックまたは実データ）を読み込む。  
  3. （機能3未実装時）ユーザーが推薦対象の日本酒リスト（メニュー）を手入力する。  
  4. （機能3実装後）ユーザーが機能3で取り込んだメニューデータ（銘柄リスト）を推薦対象として指定する。  
  5. システムが飲酒歴データ（特に評価と味の感想）とメニューリストを照合・分析し、各銘柄のおすすめ度合いと説明文を計算する。  
  6. 計算結果に基づき、おすすめ上位10件を「推薦結果」データ形式（銘柄, おすすめ度合い, 説明）で整形する。  
  7. 整形したリストを画面に表示する。  
* **異常系処理フロー:**  
  * (異常系) 飲酒歴データが読み込めない（または0件の）場合 → 好み分析ができないため、「飲酒記録がありません。まずは飲んだお酒を記録してください」等のメッセージを表示する。（モック実装では発生しにくい）  
  * (異常系) 推薦対象のメニューが入力・指定されていない（0件の）場合 → 「メニューを入力（または取り込み）してください」というメッセージを表示する。  
  * (異常系) 推薦アルゴリズムが実行されたが、推薦結果が0件だった場合 → 「おすすめできる日本酒が見つかりませんでした」というメッセージを表示する。  
  * (異常系) 推薦処理中に予期せぬエラーが発生した場合 → 「推薦処理に失敗しました」というエラーメッセージを表示する。

## 2\. 飲んだ酒記録機能

* **価値:** ユーザー自身の飲酒体験（味の感想、評価）を記録・蓄積できるようにする。これにより、自身の好みを客観的に把握しやすくなるとともに、推薦機能(1)の精度を向上させるための教師データ（実データ）となる。  
* **入力:**  
  * 銘柄（文字列）  
  * 味の感想（文字列）  
  * 評価（4段階から選択）  
* **出力:**  
  * データベース（またはローカルストレージ）に保存された「飲酒歴」データ  
  * （画面）保存完了メッセージ  
  * （画面、余裕があれば）保存された飲酒歴の履歴閲覧リスト  
* **正常系処理フロー:**  
  1. ユーザーが記録機能を開始する。  
  2. 入力フォーム（銘柄、味の感想、評価）が表示される。  
  3. ユーザーが各項目を入力・選択し、「保存」ボタンを押す。  
  4. システムは入力データが制約（文字数など）を満たしているか検証する。  
  5. 検証が通れば、入力データを「飲酒歴」データ形式でデータベースに保存する。  
  6. 「保存しました」というメッセージを画面に表示する。  
  7. （余裕があれば）ユーザーが履歴閲覧を選択すると、保存された飲酒歴データのリストを表示する。  
* **異常系処理フロー:**  
  * (異常系) 必須項目（例: 銘柄、評価）が入力されていない場合   
    → エラーメッセージ（例: 「銘柄を入力してください」）を表示し、保存処理を中断する。  
  * (異常系) 入力文字数が制約（例: 銘柄 1～64文字）を満たしていない場合   
    → エラーメッセージ（例: 「銘柄は64文字以内で入力してください」）を表示し、保存処理を中断する。  
  * (異常系) データベースへの保存に失敗した場合   
    → 「保存に失敗しました。時間をおいて再度お試しください」というエラーメッセージを表示する。  
  * (異常系) すでに同一の日本酒をユーザーが登録している場合  
    → 上書きし、「保存しました」というメッセージを表示する。

## 3\. メニュー取り込み機能

* **価値:** OCR（光学文字認識）により、スマートフォンのカメラで撮影したメニューの写真から、日本酒の銘柄を自動でテキスト化する。これにより、推薦機能(1)利用時の手入力の手間を大幅に削減し、店内で迅速にサービスを利用できるようにする。  
* **入力:**  
  * メニューが写った写真画像（png, jpeg）  
* **出力:**  
  * OCRによって抽出された銘柄のリスト（「メニュー」データ形式）  
  * （画面）抽出結果の編集画面（ユーザーが手動で修正・追加・削除可能）  
* **正常系処理フロー:**  
  1. ユーザーがメニュー取り込み機能を開始する。  
  2. カメラ起動、またはデバイスの画像ライブラリ選択画面が表示される。  
  3. ユーザーがメニューの写真を撮影する。  
  4. 選択された画像がサーバーのOCRエンジンに送信される。  
  5. OCRエンジンが画像からテキストを抽出し、特に日本酒の銘柄らしき文字列を認識する。  
  6. 抽出されたテキストリストを「メニュー」データ形式（銘柄のリスト）に整形する。  
  7. 抽出結果を画面に表示し、ユーザーが手動で修正（追加・編集・削除）できるインターフェースを提供する。  
  8. ユーザーが修正を完了すると、そのデータが推薦機能(1)の入力として利用可能になる。  
* **異常系処理フロー:**  
  * (異常系) ユーザーがカメラや写真ライブラリへのアクセスを許可しなかった場合 → 「カメラ（または写真）へのアクセスを許可してください」というメッセージを表示する。  
  * (異常系) 選択された画像ファイルの形式が対応していない（png, jpeg以外など）場合 → 「対応していないファイル形式です」というエラーメッセージを表示する。  
  * (異常系) OCR処理（画像のアップロード含む）に失敗した場合 → 「メニューの読み取りに失敗しました」というエラーメッセージを表示する。  
  * (異常系) OCRでテキストが全く抽出できなかった場合（例: 真っ暗な画像） → 「メニューを検出できませんでした。手動で入力してください」というメッセージを表示する。

## 4\. ラベル画像撮影・アップロード機能

* **価値:** 飲酒記録(2)に、飲んだ日本酒のラベル画像を追加できるようにする。視覚的な情報（デザインや銘柄の漢字など）が味の記憶と強く結びつくため、後から記録を振り返る際の想起を助ける。  
* **入力:**  
  * 日本酒のラベルが写った写真画像（png, jpegなど、20MB以下）  
* **出力:**  
  * アップロードされ、該当の飲酒歴データに紐づけられた画像データ（またはその保存先パス）  
* **正常系処理フロー:**  
  1. ユーザーが飲酒記録(2)の入力・編集画面で「ラベル画像追加」ボタンを押す。  
  2. カメラ起動  
  3. ユーザーがラベルの写真を撮影する。  
  4. 選択された画像がプレビューとして画面に表示される。  
  5. ユーザーが飲酒記録の「保存」ボタンを押す。（この機能は記録機能(2)のフローに統合される）  
  6. システムは、他の記録データ（銘柄、感想など）と共に、画像データを指定された制約（形式、20MB以下）で検証・保存し、該当の飲酒歴データに紐づける。  
* **異常系処理フロー:**  
  * (異常系) 画像ファイルの形式が対応していない場合 → エラーメッセージ（例: 「pngまたはjpeg形式の画像を選択してください」）を表示し、画像の紐付けを中断する（記録自体の保存は継続可能）。  
  * (異常系) 画像ファイルのサイズが上限（20MB）を超える場合 → 「ファイルサイズが大きすぎます（20MB以下にしてください）」というエラーメッセージを表示し、画像の紐付けを中断する。  
  * (異常系) 画像のアップロードまたは保存処理に失敗した場合 → 「画像の保存に失敗しました」というエラーメッセージを表示する（記録自体の保存は継続可能）。

## 5\. 味から検索機能

* **価値:** 蓄積された過去の飲酒記録(2)を、味の感想に含まれるキーワードで検索できるようにする。「以前飲んだ、あのフルーティなお酒」といった曖昧な記憶から、該当の記録を簡単に見つけ出せるようにする。  
* **入力:**  
  * 検索キーワード（文字列）  
* **出力:**  
  * （画面）検索キーワードを「味の感想」または「銘柄」に含む飲酒歴データのリスト  
* **正常系処理フロー:**  
  1. ユーザーが検索機能を開始し、検索キーワード入力欄を表示する。  
  2. ユーザーがキーワード（例: 「フルーティ」「辛口」）を入力し、検索ボタンを押す。  
  3. システムが、保存されている全飲酒歴データの「味の感想」フィールド（および「銘柄」フィールド）に対して、キーワードによる部分一致検索を実行する。  
  4. ヒットした飲酒歴データのリスト（銘柄、感想、評価、ラベル画像など）を画面に時系列順（または関連度順）で表示する。  
* **異常系処理フロー:**  
  * (異常系) 検索キーワードが入力されていない状態で検索ボタンが押された場合 → （特に処理しないか、「キーワードを入力してください」と表示する）  
  * (異常系) 検索結果が0件だった場合 → 「該当する記録が見つかりませんでした」というメッセージを表示する。  
  * (異常系) 検索処理中にデータベースエラーなどが発生した場合 → 「検索に失敗しました」というエラーメッセージを表示する。  
  * 

# データ形式

制約系は余裕があったらしっかり適用されるようにすれば ok くらいの緩い値。  
for todo: 気になる点あったら適宜いじってください

## 飲酒歴

記録機能(2)で記録して、推薦機能(1)で個人の好みの参考として利用する履歴。  
以下のフィールドを持つ。

* 銘柄(必須)  
  * 日本語文字列  
  * 1\~64文字  
* 味の感想(必須)  
  * 日本語文字列  
  * 1\~1000文字  
* 評価(必須)  
  * 4段階  
    * 非常に好き  
    * 好き  
    * 合わない  
    * 非常に合わない  
  * ラベルはいい感じに変えていいです(for todo)  
* ラベル画像(任意)  
  * 4 で追加  
  * png、jpegあたりに対応しておけば良さそう？  
  * 20MB 以下

## 推薦結果

推薦機能(1)で結果として提示する。  
以下のフィールドを持つ。

* 銘柄(必須)  
  * 日本語文字列  
  * 1\~64文字  
* おすすめ度合い(必須)  
  * 数値  
  * 1\~5  
* 説明(必須)  
  * 日本語文字列  
  * 1\~500文字

## メニュー

推薦機能(1)で入力し、メニュー取り込み機能(3)で写真をもとに取り込む値。  
各メニューごとに以下のフィールドを持つ。

* 銘柄(必須)  
  * 日本語文字列  
  * 1\~64文字